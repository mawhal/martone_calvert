b <- ggplot(predictions_cop, aes_string(x = 'elev', y = taxon, col='year'))+
geom_smooth(aes(group=year1),se=F,lwd=1.5) +
scale_color_manual(values=cols.two) +
ylab("") +
xlab("") +
theme_classic() +
theme(legend.position = "none") +
# theme(legend.position = c(1,0.25), legend.justification = c(1,0) ) +
theme(axis.title.x = element_blank(),
axis.title.y = element_blank())
c <- ggplot(predictions_abun, aes_string(x = 'elev', y = taxon, col='year'))+
geom_smooth(aes(group=year1),se=F,lwd=1.5) +
scale_color_manual(values=cols.two) +
# ylab("percent cover") +
# xlab("elevation (cm)") +
ylab("") +
xlab("") +
theme_classic() +
# theme(legend.position = "none") +
theme(legend.position = c(1,0.25), legend.justification = c(1,0) ) +
theme(axis.title.x = element_blank(),
axis.title.y = element_blank())
plot_grid(c,a,b,ncol=1, align='hv')
ggsave( paste0("R/Figs/hmsc_elev_metrics_",taxon,".svg"), height = 4.5, width = 1.6 ) # width 1.75 for Hedophyllum
Years <- 2012:2019
slopes <- sapply(X = 1:dim(scaled_occur)[2], FUN = function(i){
sapply(X = 1:dim(scaled_occur)[3], FUN = function(x){
c(coef(lm(scaled_occur[,i,x]~Years))[2])
})
})
slopes_con_biomass_ln <- sapply(X = 1:dim(log_con_bmass)[2], FUN = function(i){
sapply(X = 1:dim(log_con_bmass)[3], FUN = function(x){
c(coef(lm(log_con_bmass[,i,x]~Years))[2])
})
})
slopes_biomass_ln <- sapply(X = 1:dim(log_biomass)[2], FUN = function(i){
sapply(X = 1:dim(log_biomass)[3], FUN = function(x){
c(coef(lm(log_biomass[,i,x]~Years))[2])
})
})
occur_trends <- data.frame(species = colnames(models[[1]]$Y),
median = apply(slopes, 2, median),
lower_0.25 = apply(slopes, 2, quantile, prob = 0.25),
upper_0.75 = apply(slopes, 2, quantile, prob = 0.75),
lower = apply(slopes, 2, quantile, prob = 0.025),
upper = apply(slopes, 2, quantile, prob = 0.975),
measure = 'Occurrence prob.')
biomass_cond_ln_trends <- data.frame(species = colnames(models[[1]]$Y),
median = apply(slopes_con_biomass_ln, 2, median),
lower_0.25 = apply(slopes_con_biomass_ln, 2, quantile, prob = 0.25),
upper_0.75 = apply(slopes_con_biomass_ln, 2, quantile, prob = 0.75),
lower = apply(slopes_con_biomass_ln, 2, quantile, prob = 0.025),
upper = apply(slopes_con_biomass_ln, 2, quantile, prob = 0.975),
measure = 'Conditional cover (log)')
biomass_ln_trends <- data.frame(species = colnames(models[[1]]$Y),
median = apply(slopes_biomass_ln, 2, median),
lower_0.25 = apply(slopes_biomass_ln, 2, quantile, prob = 0.25),
upper_0.75 = apply(slopes_biomass_ln, 2, quantile, prob = 0.75),
lower = apply(slopes_biomass_ln, 2, quantile, prob = 0.025),
upper = apply(slopes_biomass_ln, 2, quantile, prob = 0.975),
measure = 'Cover (log)')
all_trends <- bind_rows(occur_trends, biomass_cond_ln_trends, biomass_ln_trends) %>%
mutate(sig = sign(upper) == sign(lower)) %>%
mutate(sign = ifelse(median > 0 & sig == TRUE, 'increasing', ifelse(median < 0 & sig == TRUE, 'decreasing', 'no trend'))) %>%
mutate(sign = factor(sign, levels = c('decreasing', 'no trend', 'increasing'), ordered = TRUE)) %>%
mutate(species = factor(species, levels = occur_trends$species[order(occur_trends$median)], ordered = TRUE)) %>%
mutate(measure = factor(measure, levels = c('Occurrence prob.', 'Conditional cover (log)', 'Cover (log)')))
all_trends %>%
ggplot(aes(x = species, y = median, color = sign))+
geom_vline(xintercept = c(levels(all_trends$species)[seq(3, models[[1]]$ns, by = 3)]), col = 'grey', size = 0.1, linetype = 2)+
geom_hline(yintercept = 0, linetype = 2)+
geom_errorbar(aes(ymin = lower_0.25, ymax = upper_0.75), width = 0, size = 1)+
geom_errorbar(aes(ymin = lower, ymax = upper), width = 0)+
geom_point()+
coord_flip()+
facet_wrap(~measure, scales = 'free_x')+
scale_color_manual(values = c('blue', 'grey', 'red'), guide = FALSE)+
ylab('Change per year')+
xlab('')
ggsave("hmsc_species_trends_summary.svg",width = 12, height = 12)
ggsave("R/Figs/hmsc_species_trends_summary.svg",width = 12, height = 12)
ggsave("R/Figs/hmsc_species_trends_summary.svg",width = 8, height = 8)
ggsave("R/Figs/hmsc_species_trends_summary.svg",width = 6, height = 7)
all_trends <- bind_rows(occur_trends, biomass_cond_ln_trends, biomass_ln_trends) %>%
mutate(sig = sign(upper) == sign(lower)) %>%
mutate(sign = ifelse(median > 0 & sig == TRUE, 'increasing', ifelse(median < 0 & sig == TRUE, 'decreasing', 'no trend'))) %>%
mutate(sign = factor(sign, levels = c('decreasing', 'no trend', 'increasing'), ordered = TRUE)) %>%
mutate(species = gsub("_",".",species)) %>%
mutate(species = factor(species, levels = occur_trends$species[order(occur_trends$median)], ordered = TRUE)) %>%
mutate(measure = factor(measure, levels = c('Occurrence prob.', 'Conditional cover (log)', 'Cover (log)')))
all_trends %>%
ggplot(aes(x = species, y = median, color = sign))+
geom_vline(xintercept = c(levels(all_trends$species)[seq(3, models[[1]]$ns, by = 3)]), col = 'grey', size = 0.1, linetype = 2)+
geom_hline(yintercept = 0, linetype = 2)+
geom_errorbar(aes(ymin = lower_0.25, ymax = upper_0.75), width = 0, size = 1)+
geom_errorbar(aes(ymin = lower, ymax = upper), width = 0)+
geom_point()+
coord_flip()+
facet_wrap(~measure, scales = 'free_x')+
scale_color_manual(values = c('blue', 'grey', 'red'), guide = FALSE)+
ylab('Change per year')+
xlab('')
ggsave("R/Figs/hmsc_species_trends_summary.svg",width = 6, height = 7)
all_trends <- bind_rows(occur_trends, biomass_cond_ln_trends, biomass_ln_trends) %>%
mutate(sig = sign(upper) == sign(lower)) %>%
mutate(sign = ifelse(median > 0 & sig == TRUE, 'increasing', ifelse(median < 0 & sig == TRUE, 'decreasing', 'no trend'))) %>%
mutate(sign = factor(sign, levels = c('decreasing', 'no trend', 'increasing'), ordered = TRUE)) %>%
mutate(species = gsub("_",".",species)) %>%
mutate(species = factor(species, levels = gsub("_",".",occur_trends$species[order(occur_trends$median)]), ordered = TRUE)) %>%
mutate(measure = factor(measure, levels = c('Occurrence prob.', 'Conditional cover (log)', 'Cover (log)')))
all_trends %>%
ggplot(aes(x = species, y = median, color = sign))+
geom_vline(xintercept = c(levels(all_trends$species)[seq(3, models[[1]]$ns, by = 3)]), col = 'grey', size = 0.1, linetype = 2)+
geom_hline(yintercept = 0, linetype = 2)+
geom_errorbar(aes(ymin = lower_0.25, ymax = upper_0.75), width = 0, size = 1)+
geom_errorbar(aes(ymin = lower, ymax = upper), width = 0)+
geom_point()+
coord_flip()+
facet_wrap(~measure, scales = 'free_x')+
scale_color_manual(values = c('blue', 'grey', 'red'), guide = FALSE)+
ylab('Change per year')+
xlab('')
ggsave("R/Figs/hmsc_species_trends_summary.svg",width = 6, height = 7)
all_trends %>%
ggplot(aes(x = species, y = median, color = sign))+
geom_vline(xintercept = c(levels(all_trends$species)[seq(3, models[[1]]$ns, by = 3)]), col = 'grey', size = 0.1, linetype = 2)+
geom_hline(yintercept = 0, linetype = 2)+
geom_errorbar(aes(ymin = lower_0.25, ymax = upper_0.75), width = 0, size = 1)+
geom_errorbar(aes(ymin = lower, ymax = upper), width = 0)+
geom_point()+
coord_flip()+
facet_wrap(~measure, scales = 'free_x')+
scale_color_manual(values = c('blue', 'grey', 'red'), guide = FALSE)+
scale_x_continuous(guide = guide_axis(check.overlap = TRUE)) +
ylab('Change per year')+
xlab('')
all_trends %>%
ggplot(aes(x = species, y = median, color = sign))+
geom_vline(xintercept = c(levels(all_trends$species)[seq(3, models[[1]]$ns, by = 3)]), col = 'grey', size = 0.1, linetype = 2)+
geom_hline(yintercept = 0, linetype = 2)+
geom_errorbar(aes(ymin = lower_0.25, ymax = upper_0.75), width = 0, size = 1)+
geom_errorbar(aes(ymin = lower, ymax = upper), width = 0)+
geom_point()+
coord_flip()+
facet_wrap(~measure, scales = 'free_x')+
scale_color_manual(values = c('blue', 'grey', 'red'), guide = FALSE)+
scale_x_continuous(breaks = round(seq(min(dat$x), max(dat$x), by = 0.5),1)) +
ylab('Change per year')+
xlab('')
round(seq(min(all_trends$median), max(all_trends$median), by = 0.5),1)
all_trends %>%
ggplot(aes(x = species, y = median, color = sign))+
geom_vline(xintercept = c(levels(all_trends$species)[seq(3, models[[1]]$ns, by = 3)]), col = 'grey', size = 0.1, linetype = 2)+
geom_hline(yintercept = 0, linetype = 2)+
geom_errorbar(aes(ymin = lower_0.25, ymax = upper_0.75), width = 0, size = 1)+
geom_errorbar(aes(ymin = lower, ymax = upper), width = 0)+
geom_point()+
coord_flip()+
facet_wrap(~measure, scales = 'free_x')+
scale_color_manual(values = c('blue', 'grey', 'red'), guide = FALSE)+
scale_y_continuous(breaks = scales::pretty_breaks(n = 2)) +
ylab('Change per year')+
xlab('')
all_trends %>%
ggplot(aes(x = species, y = median, color = sign))+
geom_vline(xintercept = c(levels(all_trends$species)[seq(3, models[[1]]$ns, by = 3)]), col = 'grey', size = 0.1, linetype = 2)+
geom_hline(yintercept = 0, linetype = 2)+
geom_errorbar(aes(ymin = lower_0.25, ymax = upper_0.75), width = 0, size = 1)+
geom_errorbar(aes(ymin = lower, ymax = upper), width = 0)+
geom_point()+
coord_flip()+
facet_wrap(~measure, scales = 'free_x')+
scale_color_manual(values = c('blue', 'grey', 'red'), guide = FALSE)+
scale_y_continuous(breaks = scales::pretty_breaks(n = 3)) +
ylab('Change per year')+
xlab('')
ggsave("R/Figs/hmsc_species_trends_summary.svg",width = 6, height = 7)
%>%
# add empirical means
models[[1]]$studyDesign %>%
group_by(year) %>%
summarize(ntrans=length(transect))
ogd <- bind_cols(  models[[1]]$studyDesign, comm.all )  #data.frame(m$Y)
ogd$year <- as.numeric(as.character(ogd$year))
ogd.long <- ogd.mean <- ogd %>%
pivot_longer( cols=names(comm.all)[1]:names(comm.all)[length(names(comm.all))],
names_to = "taxon", values_to = "N" )
ogd.mean <- ogd %>%
pivot_longer( cols=names(comm.all)[1]:names(comm.all)[length(names(comm.all))],
names_to = "taxon", values_to = "N" ) %>%
group_by( year, transect , taxon) %>%
summarize( N = mean(N) )
ogd.pa <- ogd %>%
pivot_longer( cols=names(comm.all)[1]:names(comm.all)[length(names(comm.all))],
names_to = "taxon", values_to = "N" ) %>%
group_by( transect , taxon ) %>%
summarize( pa = sum(N) ) %>%
filter( pa > 0 )
# zero presence in entire survey
ogd.zeros <- ogd %>%
pivot_longer( cols=names(comm.all)[1]:names(comm.all)[length(names(comm.all))],
names_to = "taxon", values_to = "N" ) %>%
group_by( taxon ) %>%
mutate( Nmean=mean(N) ) %>%
group_by( year, taxon, Nmean ) %>%
summarize( pa = sum(N) ) %>%
filter( pa == 0 ) %>%
arrange( -Nmean )
ogd.mean.pa <- full_join(ogd.mean, ogd.pa)
ogd.mean.pa <- ogd.mean.pa %>%
ungroup() %>%
# filter( !is.na(pa) ) %>%
mutate( year =  as.numeric(as.character(year)) )
ogd.mean.pa.mean <- ogd.mean.pa %>%
group_by(year,taxon) %>%
summarize(N=mean(N))
species <- c("Alaria.marginata","Hedophyllum.sessile")
species_temporal.df$taxon <- gsub("\n", ".", species_temporal.df$Species)
predictions_abund_mean <- predictions_abund %>%
group_by( year, site, transect, taxon) %>%
summarize( N = mean(N) )
predictions_abun
## tidy the data and combine
predictions_abund <- predictions_abun %>%
gather(key = taxon, value = N, Fucus.distichus:Mazzaella.parvula)
predictions_abund_low <- predictions_abun_low %>%
gather(key = taxon, value = N_low, Fucus.distichus:Mazzaella.parvula)
predictions_abund_high <- predictions_abun_high %>%
gather(key = taxon, value = N_high, Fucus.distichus:Mazzaella.parvula)
predictions_abund <- left_join(left_join(predictions_abund, predictions_abund_low), predictions_abund_high)
predictions_abund$taxon <- factor(predictions_abund$taxon, levels = colnames(Y)[order(colSums(Y),decreasing = T)], ordered = FALSE)
predictions_abund <- left_join(predictions_abund,newDF)
predictions_abund_mean <- predictions_abund %>%
group_by( year, site, transect, taxon) %>%
summarize( N = mean(N) )
predictions_abund
newDF
head(predictions_abund)
ogd.mean
head(predictions_abund)
predictions_abund_mean <- predictions_abund %>%
group_by( year,  taxon) %>%  #site, transect,
summarize( N = mean(N) )
predictions_abund_mean
alpha_choose = 0.1
alpha_choose2 = 1
size_choose = 2.5
size_choose2 = 5
point_colors <- c("slateblue","firebrick", "goldenrod" )
for(i in 1:length(species)){
# abun.time.plot <- species_temporal.df %>%
abun.time.plot <- predictions_abund_mean %>%
filter(taxon %in% species[[i]] ) %>% ungroup() #%>%
# filter( metric == "conditional cover" ) %>%
# mutate( N = median )
# ggplot( abun.time.plot, aes( x=year, y=exp(N), group=taxon, col=taxon ) ) +
ggplot( abun.time.plot, aes( x=year, y=N, group=taxon, col=taxon ) ) +
# geom_ribbon( aes(x=year, ymin=N_high/90, ymax=N_low/90), fill="grey70", alpha=0.5 ) +
# facet_wrap(~taxon, scales="free_y",ncol=1) +
geom_path(size=size_choose, alpha=alpha_choose2) +
# geom_point( data=filter(ogd.mean.pa, taxon %in% species ), aes(y=N+0.01111111), size=5, alpha = 0.1 ) +
geom_point( data=filter(ogd.mean, taxon %in% species[[i]] ), aes(y=N+0.01111111), size=size_choose2,
alpha = alpha_choose, position = position_dodge(width = 0.25) ) +
geom_path( data=filter(ogd.mean.pa.mean, taxon %in% species[[i]] ), aes(y=N+0.01111111), lwd=0.75, alpha = 1 ) +
# stat_summary( data=filter(ogd.mean.pa, taxon %in% species ), aes(y=N), fun = "median", geom="line", size = 0.5 ) +
scale_color_manual(values=point_colors[1:length(species[[i]])]) +
ylab("Percent Cover") +
theme_classic() +
theme(legend.position="top") +
# ylim( c(0,18) ) +
# scale_y_sqrt(labels = comma, breaks = c(0, 1.01111111, 10, 25, 50, 75, 100)) +
scale_y_log10(labels = comma) +
# scale_y_continuous(labels = comma) +
guides(color=guide_legend(nrow=2,ncol=2,byrow=F))
ggsave( paste0("R/Figs/temporal_trends_select_taxa/",paste0(species[[i]],collapse="_"),"_model+data.svg"),
width=3,height=3.5)
}
abun.time.plot
species_temporal.df
species_bmass
bmass_mean
species_bmass
species_occur <- left_join(apply(scaled_occur, c(1,2), median) %>%  as.data.frame() %>% mutate(year = 2012:2019, metric = "occurrence") %>% gather(key = Species, value = median, -year, -metric),
apply(scaled_occur, c(1,2), quantile, prob = 0.25) %>%  as.data.frame() %>% mutate(year = 2012:2019, metric = "occurrence") %>% gather(key = Species, value = quant_0.25, -year, -metric)) %>%
left_join(apply(scaled_occur, c(1,2), quantile, prob = 0.75) %>%  as.data.frame() %>% mutate(year = 2012:2019, metric = "occurrence") %>% gather(key = Species, value = quant_0.75, -year, -metric))
species_occur_scale <- species_occur %>%
gather(key = quant, value = value, median:quant_0.75) %>%
mutate(value = scale(value)) %>%
spread(key = quant, value = value)
species_con_bmass <- left_join(apply(log_con_bmass, c(1,2), median) %>%  as.data.frame() %>% mutate(year = 2012:2019, metric = "conditional cover") %>% gather(key = Species, value = median, -year, -metric),
apply(log_con_bmass, c(1,2), quantile, prob = 0.25) %>%  as.data.frame() %>% mutate(year = 2012:2019, metric = "conditional cover") %>% gather(key = Species, value = quant_0.25, -year, -metric)) %>%
left_join(apply(log_con_bmass, c(1,2), quantile, prob = 0.75) %>%  as.data.frame() %>% mutate(year = 2012:2019, metric = "conditional cover") %>% gather(key = Species, value = quant_0.75, -year, -metric))
species_con_bmass_scale <- species_con_bmass %>%
gather(key = quant, value = value, median:quant_0.75) %>%
mutate(value = scale(value)) %>%
spread(key = quant, value = value)
species_bmass <- left_join(apply(log_biomass, c(1,2), median) %>%  as.data.frame() %>% mutate(year = 2012:2019, metric = "cover") %>% gather(key = Species, value = median, -year, -metric),
apply(log_biomass, c(1,2), quantile, prob = 0.25) %>%  as.data.frame() %>% mutate(year = 2012:2019, metric = "cover") %>% gather(key = Species, value = quant_0.25, -year, -metric)) %>%
left_join(apply(log_biomass, c(1,2), quantile, prob = 0.75) %>%  as.data.frame() %>% mutate(year = 2012:2019, metric = "cover") %>% gather(key = Species, value = quant_0.75, -year, -metric))
species_bmass_scale <- species_bmass %>%
gather(key = quant, value = value, median:quant_0.75) %>%
mutate(value = scale(value)) %>%
spread(key = quant, value = value)
species_temporal.df <- rbind(species_occur_scale, species_con_bmass_scale, species_bmass)
species_temporal.df <- left_join( mutate(species_temporal.df,year=round(year,7)), years )
## plot trends for all species
# species_temporal.df$Species <- factor(species_temporal.df$Species, levels = order_occur$Species, ordered = TRUE)
# species_temporal.df$Species <- factor(species_temporal.df$Species, levels = order_occur$Species, labels = gsub("[.]","\n",order_occur$Species), ordered = TRUE)
species_temporal.df$Species <- gsub("_",".", species_temporal.df$Species)
species_temporal.df$metric  <- factor(species_temporal.df$metric, levels = c("occurrence","conditional cover","cover"))
sp.trends <- ggplot(species_temporal.df, aes(x = year, y = median, color = metric,  fill = metric, group = metric))+ #fill = metric,
geom_ribbon(aes(ymin = quant_0.25, ymax= quant_0.75), alpha = 0.2, col = NA)+
geom_line(size = 1)+
facet_wrap(~Species, scales = "free", ncol = 6)+
# scale_color_brewer(type = "qual", palette = "Dark2", name = "")+
# scale_fill_brewer(type = "qual", palette = "Dark2", name = "", guide = FALSE)+
scale_color_manual( values = c('gray25','seagreen','springgreen') ) +
scale_fill_manual( values = c('gray50','seagreen','springgreen3') ) +
xlab("Year")+
ylab("Scaled estimate")+
theme_classic() + theme(legend.position = "top")
species_bmass
species_temporal.df
i=1
# abun.time.plot <- species_temporal.df %>%
abun.time.plot <- species_bmass %>%
filter(taxon %in% species[[i]] ) %>% ungroup() #%>%
abun.time.plot
species[[i]]
species_bmass
# abun.time.plot <- species_temporal.df %>%
abun.time.plot <- species_bmass %>%
filter(Species %in% species[[i]] ) %>% ungroup() #%>%
abun.time.plot
ggplot( abun.time.plot, aes( x=year, y=N, group=taxon, col=taxon ) ) +
# geom_ribbon( aes(x=year, ymin=N_high/90, ymax=N_low/90), fill="grey70", alpha=0.5 ) +
# facet_wrap(~taxon, scales="free_y",ncol=1) +
geom_path(size=size_choose, alpha=alpha_choose2)
ggplot( abun.time.plot, aes( x=year, y=exp(median), group=Species, col=Species ) ) +
# geom_ribbon( aes(x=year, ymin=N_high/90, ymax=N_low/90), fill="grey70", alpha=0.5 ) +
# facet_wrap(~taxon, scales="free_y",ncol=1) +
geom_path(size=size_choose, alpha=alpha_choose2)
ggplot( abun.time.plot, aes( x=year, y=exp(median), group=Species, col=Species ) ) +
# geom_ribbon( aes(x=year, ymin=N_high/90, ymax=N_low/90), fill="grey70", alpha=0.5 ) +
# facet_wrap(~taxon, scales="free_y",ncol=1) +
geom_path(size=size_choose, alpha=alpha_choose2) +
# geom_point( data=filter(ogd.mean.pa, taxon %in% species ), aes(y=N+0.01111111), size=5, alpha = 0.1 ) +
geom_point( data=filter(ogd.mean, taxon %in% species[[i]] ), aes(y=N+0.01111111), size=size_choose2,
alpha = alpha_choose, position = position_dodge(width = 0.25) )
ggplot( abun.time.plot, aes( x=year, y=exp(median), group=Species, col=Species ) ) +
# geom_ribbon( aes(x=year, ymin=N_high/90, ymax=N_low/90), fill="grey70", alpha=0.5 ) +
# facet_wrap(~taxon, scales="free_y",ncol=1) +
geom_path(size=size_choose, alpha=alpha_choose2) +
# geom_point( data=filter(ogd.mean.pa, taxon %in% species ), aes(y=N+0.01111111), size=5, alpha = 0.1 ) +
geom_point( data=filter(ogd.mean, taxon %in% species[[i]] ), aes(y=N+0.01111111, group=taxon, col=taxon), size=size_choose2,
alpha = alpha_choose, position = position_dodge(width = 0.25) )
ggplot( abun.time.plot, aes( x=year, y=exp(median), group=Species, col=Species ) ) +
# geom_ribbon( aes(x=year, ymin=N_high/90, ymax=N_low/90), fill="grey70", alpha=0.5 ) +
# facet_wrap(~taxon, scales="free_y",ncol=1) +
geom_path(size=size_choose, alpha=alpha_choose2) +
# geom_point( data=filter(ogd.mean.pa, taxon %in% species ), aes(y=N+0.01111111), size=5, alpha = 0.1 ) +
geom_point( data=filter(ogd.mean, taxon %in% species[[i]] ), aes(y=N+0.01111111, group=taxon, col=taxon), size=size_choose2,
alpha = alpha_choose, position = position_dodge(width = 0.25) ) +
geom_path( data=filter(ogd.mean.pa.mean, taxon %in% species[[i]] ), aes(y=N+0.01111111, group=taxon, col=taxon), lwd=0.75, alpha = 1 ) +
# stat_summary( data=filter(ogd.mean.pa, taxon %in% species ), aes(y=N), fun = "median", geom="line", size = 0.5 ) +
scale_color_manual(values=point_colors[1:length(species[[i]])]) +
ylab("Percent Cover") +
theme_classic() +
theme(legend.position="top") +
# ylim( c(0,18) ) +
# scale_y_sqrt(labels = comma, breaks = c(0, 1.01111111, 10, 25, 50, 75, 100)) +
scale_y_log10(labels = comma) +
# scale_y_continuous(labels = comma) +
guides(color=guide_legend(nrow=2,ncol=2,byrow=F))
for(i in 1:length(species)){
# abun.time.plot <- species_temporal.df %>%
abun.time.plot <- species_bmass %>%
filter(Species %in% species[[i]] ) %>% ungroup() #%>%
# filter( metric == "conditional cover" ) %>%
# mutate( N = median )
# ggplot( abun.time.plot, aes( x=year, y=exp(N), group=taxon, col=taxon ) ) +
ggplot( abun.time.plot, aes( x=year, y=exp(median), group=Species, col=Species ) ) +
# geom_ribbon( aes(x=year, ymin=N_high/90, ymax=N_low/90), fill="grey70", alpha=0.5 ) +
# facet_wrap(~taxon, scales="free_y",ncol=1) +
geom_path(size=size_choose, alpha=alpha_choose2) +
# geom_point( data=filter(ogd.mean.pa, taxon %in% species ), aes(y=N+0.01111111), size=5, alpha = 0.1 ) +
geom_point( data=filter(ogd.mean, taxon %in% species[[i]] ), aes(y=N+0.01111111, group=taxon, col=taxon), size=size_choose2,
alpha = alpha_choose, position = position_dodge(width = 0.25) ) +
geom_path( data=filter(ogd.mean.pa.mean, taxon %in% species[[i]] ), aes(y=N+0.01111111, group=taxon, col=taxon), lwd=0.75, alpha = 1 ) +
# stat_summary( data=filter(ogd.mean.pa, taxon %in% species ), aes(y=N), fun = "median", geom="line", size = 0.5 ) +
scale_color_manual(values=point_colors[1:length(species[[i]])]) +
ylab("Percent Cover") +
theme_classic() +
theme(legend.position="top") +
# ylim( c(0,18) ) +
# scale_y_sqrt(labels = comma, breaks = c(0, 1.01111111, 10, 25, 50, 75, 100)) +
scale_y_log10(labels = comma) +
# scale_y_continuous(labels = comma) +
guides(color=guide_legend(nrow=2,ncol=2,byrow=F))
ggsave( paste0("R/Figs/temporal_trends_select_taxa/",paste0(species[[i]],collapse="_"),"_model+data.svg"),
width=3,height=3.5)
}
species <- list( c("Fucus.distichus","Elachista.fucicola"),c("Palmaria.hecatensis","Palmaria.mollis") ,c("Polysiphonia","Lithothamnion.phymatodeum"),"Pyropia",c("Alaria.marginata","Hedophyllum.sessile"),c( "Mazzaella.parvula", "Mazzaella.oregona", "Mazzaella.splendens" ),"Cladophora.columbiana","Corallina",c("Colpomenia.bullosa","Colpomenia.peregrina"),c("Mastocarpus","Petrocelis"),c("Phyllospadix.sp."),c("Gloiopeltis.furcata"),c("Barnacles","Mytilus.sp."),c("Costaria.costata","Osmundea.spectabilis","Nemalion.helminthoides"),c("Scytosiphon.lomentaria","Lomentaria.hakodatensis","Salishia.firma"),c("Erythrotrichia.carnea","Ectocarpus.commensalis","Elachista.fucicola"))
for(i in 1:length(species)){
abun.time.plot <- species_bmass %>%
filter(Species %in% species[[i]] ) %>% ungroup() #%>%
ggplot( abun.time.plot, aes( x=year, y=exp(median), group=Species, col=Species ) ) +
# geom_ribbon( aes(x=year, ymin=N_high/90, ymax=N_low/90), fill="grey70", alpha=0.5 ) +
# facet_wrap(~taxon, scales="free_y",ncol=1) +
geom_path(size=size_choose, alpha=alpha_choose2) +
# geom_point( data=filter(ogd.mean.pa, taxon %in% species ), aes(y=N+0.01111111), size=5, alpha = 0.1 ) +
geom_point( data=filter(ogd.mean, taxon %in% species[[i]] ), aes(y=N+0.01111111, group=taxon, col=taxon), size=size_choose2,
alpha = alpha_choose, position = position_dodge(width = 0.25) ) +
geom_path( data=filter(ogd.mean.pa.mean, taxon %in% species[[i]] ), aes(y=N+0.01111111, group=taxon, col=taxon), lwd=0.75, alpha = 1 ) +
# stat_summary( data=filter(ogd.mean.pa, taxon %in% species ), aes(y=N), fun = "median", geom="line", size = 0.5 ) +
scale_color_manual(values=point_colors[1:length(species[[i]])]) +
ylab("Percent Cover") +
theme_classic() +
theme(legend.position="top") +
# ylim( c(0,18) ) +
# scale_y_sqrt(labels = comma, breaks = c(0, 1.01111111, 10, 25, 50, 75, 100)) +
scale_y_log10(labels = comma) +
# scale_y_continuous(labels = comma) +
guides(color=guide_legend(nrow=2,ncol=2,byrow=F))
ggsave( paste0("R/Figs/temporal_trends_select_taxa/",paste0(species[[i]],collapse="_"),"_model+data.svg"),
width=3,height=3.5)
}
for(i in 1:length(species)){
abun.time.plot <- species_bmass %>%
filter(Species %in% species[[i]] ) %>% ungroup() #%>%
ggplot( abun.time.plot, aes( x=year, y=exp(median), group=Species, col=Species ) ) +
# geom_ribbon( aes(x=year, ymin=N_high/90, ymax=N_low/90), fill="grey70", alpha=0.5 ) +
# facet_wrap(~taxon, scales="free_y",ncol=1) +
geom_path(size=size_choose, alpha=alpha_choose2) +
# geom_point( data=filter(ogd.mean.pa, taxon %in% species ), aes(y=N+0.01111111), size=5, alpha = 0.1 ) +
geom_point( data=filter(ogd.mean, taxon %in% species[[i]] ), aes(y=N+0.01111111, group=taxon, col=taxon), size=size_choose2,
alpha = alpha_choose, position = position_dodge(width = 0.25) ) +
geom_path( data=filter(ogd.mean.pa.mean, taxon %in% species[[i]] ), aes(y=N+0.01111111, group=taxon, col=taxon), lwd=0.75, alpha = 1 ) +
# stat_summary( data=filter(ogd.mean.pa, taxon %in% species ), aes(y=N), fun = "median", geom="line", size = 0.5 ) +
scale_color_manual(values=point_colors[1:length(species[[i]])]) +
ylab("Percent Cover") +
theme_classic() +
theme(legend.position="top") +
# ylim( c(0,18) ) +
# scale_y_sqrt(labels = comma, breaks = c(0, 1.01111111, 10, 25, 50, 75, 100)) +
scale_y_log10(labels = comma) +
# scale_y_continuous(labels = comma) +
guides(color=guide_legend(nrow=3,ncol=1,byrow=F))
ggsave( paste0("R/Figs/temporal_trends_select_taxa/",paste0(species[[i]],collapse="_"),"_model+data.svg"),
width=3,height=3.5)
}
for(i in 1:length(species)){
abun.time.plot <- species_bmass %>%
filter(Species %in% species[[i]] ) %>% ungroup() #%>%
ggplot( abun.time.plot, aes( x=year, y=exp(median), group=Species, col=Species ) ) +
# geom_ribbon( aes(x=year, ymin=N_high/90, ymax=N_low/90), fill="grey70", alpha=0.5 ) +
# facet_wrap(~taxon, scales="free_y",ncol=1) +
geom_path(size=size_choose, alpha=alpha_choose2) +
# geom_point( data=filter(ogd.mean.pa, taxon %in% species ), aes(y=N+0.01111111), size=5, alpha = 0.1 ) +
geom_point( data=filter(ogd.mean, taxon %in% species[[i]] ), aes(y=N+0.01111111, group=taxon, col=taxon), size=size_choose2,
alpha = alpha_choose, position = position_dodge(width = 0.25) ) +
geom_path( data=filter(ogd.mean.pa.mean, taxon %in% species[[i]] ), aes(y=N+0.01111111, group=taxon, col=taxon), lwd=0.75, alpha = 1 ) +
# stat_summary( data=filter(ogd.mean.pa, taxon %in% species ), aes(y=N), fun = "median", geom="line", size = 0.5 ) +
scale_color_manual(values=point_colors[1:length(species[[i]])]) +
ylab("Percent Cover") +
theme_classic() +
theme(legend.position = "top", legend.title = element_blank()) +
# ylim( c(0,18) ) +
# scale_y_sqrt(labels = comma, breaks = c(0, 1.01111111, 10, 25, 50, 75, 100)) +
scale_y_log10(labels = comma) +
# scale_y_continuous(labels = comma) +
guides(color=guide_legend(nrow=3,ncol=1,byrow=F))
ggsave( paste0("R/Figs/temporal_trends_select_taxa/",paste0(species[[i]],collapse="_"),"_model+data.svg"),
width=3,height=3.5)
}
species <- list( c("Fucus.distichus","Elachista.fucicola"),c("Palmaria.hecatensis","Palmaria.mollis"),
c("Polysiphonia","Lithothamnion.phymatodeum"),"Pyropia",c("Alaria.marginata","Hedophyllum.sessile"),
c( "Mazzaella.parvula", "Mazzaella.oregona", "Mazzaella.splendens" ),"Cladophora.columbiana",
"Corallina",c("Dactylosiphon.bullosus","Colpomenia.peregrina"),c("Mastocarpus","Petrocelis"),
c("Phyllospadix.sp."),c("Gloiopeltis.furcata"),c("Barnacles","Mytilus.sp."),
c("Costaria.costata","Osmundea.spectabilis","Nemalion.helminthoides"),
c("Scytosiphon.lomentaria","Lomentaria.hakodatensis","Salishia.firma"),
c("Erythrotrichia.carnea","Ectocarpus.commensalis","Elachista.fucicola"))
alpha_choose = 0.1
alpha_choose2 = 1
size_choose = 2.5
size_choose2 = 5
point_colors <- c("slateblue","firebrick", "goldenrod" )
for(i in 1:length(species)){
abun.time.plot <- species_bmass %>%
filter(Species %in% species[[i]] ) %>% ungroup() #%>%
ggplot( abun.time.plot, aes( x=year, y=exp(median), group=Species, col=Species ) ) +
# geom_ribbon( aes(x=year, ymin=N_high/90, ymax=N_low/90), fill="grey70", alpha=0.5 ) +
# facet_wrap(~taxon, scales="free_y",ncol=1) +
geom_path(size=size_choose, alpha=alpha_choose2) +
# geom_point( data=filter(ogd.mean.pa, taxon %in% species ), aes(y=N+0.01111111), size=5, alpha = 0.1 ) +
geom_point( data=filter(ogd.mean, taxon %in% species[[i]] ), aes(y=N+0.01111111, group=taxon, col=taxon), size=size_choose2,
alpha = alpha_choose, position = position_dodge(width = 0.25) ) +
geom_path( data=filter(ogd.mean.pa.mean, taxon %in% species[[i]] ), aes(y=N+0.01111111, group=taxon, col=taxon), lwd=0.75, alpha = 1 ) +
# stat_summary( data=filter(ogd.mean.pa, taxon %in% species ), aes(y=N), fun = "median", geom="line", size = 0.5 ) +
scale_color_manual(values=point_colors[1:length(species[[i]])]) +
ylab("Percent Cover") +
theme_classic() +
theme(legend.position = "top", legend.title = element_blank()) +
# ylim( c(0,18) ) +
# scale_y_sqrt(labels = comma, breaks = c(0, 1.01111111, 10, 25, 50, 75, 100)) +
scale_y_log10(labels = comma) +
# scale_y_continuous(labels = comma) +
guides(color=guide_legend(nrow=3,ncol=1,byrow=F))
ggsave( paste0("R/Figs/temporal_trends_select_taxa/",paste0(species[[i]],collapse="_"),"_model+data.svg"),
width=3,height=3.5)
}
