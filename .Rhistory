ad$Taxon <- gsub( "Panicea", "Halichondria panicea", ad$Taxon )
ad$Taxon <- gsub( "Lottornia", "Littorina", ad$Taxon )
ad$Taxon <- gsub( "Lottorine snails", "Littorina", ad$Taxon )
ad$Taxon <- gsub( "subsp ", "subsp. ", ad$Taxon )
ad$Taxon <- gsub( "Anthopleura ele.*","Anthopleura elegantissima", ad$Taxon )
ad$Taxon <- gsub( "Anthopleura x.*","Anthopleura xanthogrammica", ad$Taxon )
ad$Taxon <- gsub( "Anthopleura z.*","Anthopleura xanthogrammica", ad$Taxon )
ad$Taxon <- gsub( "bare.*","bare rock", ad$Taxon, ignore.case = TRUE )
ad$Taxon <- gsub( "Barnacles, goose-necked","Pollicipes", ad$Taxon )
ad$Taxon <- gsub( "Chamberlainum","Chamberlainium", ad$Taxon )
ad$Taxon <- gsub( "Chiton, sp.","Chiton", ad$Taxon )
ad$Taxon <- gsub( "Juvenile chitons","Chiton", ad$Taxon )
ad$Taxon <- gsub( "Crab, hermit crab","Pagurus", ad$Taxon )
ad$Taxon <- gsub( "Crab, kelp crab","Pugettia", ad$Taxon )
ad$Taxon <- gsub( "Crab, Pugetia","Pugettia", ad$Taxon )
ad$Taxon <- gsub( "Pugetia crab","Pugettia", ad$Taxon )
ad$Taxon <- gsub( "Orange sponge/soft coral","Porifera", ad$Taxon )
ad$Taxon <- gsub( "Sponge, orange","Porifera", ad$Taxon )
ad$Taxon <- gsub( "Pterosiphonia, Sp.","Savoiea robusta", ad$Taxon )
ad$Taxon <- gsub( "Tegula snails","Tegula", ad$Taxon )
ad$Taxon <- gsub( "Unknown upright coralline","articulated coralline", ad$Taxon )
ad$Taxon <- gsub( "Unknown fleshy red upright","Unknown red blade", ad$Taxon )
ad$Taxon <- gsub( "Snail eggs","Nucella eggs", ad$Taxon )
ad$Taxon <- gsub( "Snail, Sp.","Snail", ad$Taxon )
ad$Taxon <- gsub( "Chlorostoma snails", "Chlorostoma", ad$Taxon )
ad$Taxon <- gsub( "Chthalamus", "Chthamalus", ad$Taxon )
ad$Taxon <- gsub( "chiloensis 1","chiloensis sp.1", ad$Taxon )
ad$Taxon <- gsub( "Bosiella","Bossiella", ad$Taxon )
ad$Taxon <- gsub( "frondenscens","frondescens", ad$Taxon )
ad$Taxon <- gsub( "flexulosa","sp.5 chiloensis [flexuosa]", ad$Taxon )
ad$Taxon <- gsub( "sp.2chiloensis","sp.2 chiloensis", ad$Taxon )
ad$Taxon <- gsub( "reclunatum", "reclinatum", ad$Taxon )
ad$Taxon <- gsub( "Clathromorphum Neopolyporolithon", "Neopolyporolithon", ad$Taxon )
ad$Taxon <- gsub( "Endolzoic", "Endozoic", ad$Taxon )
ad$Taxon <- gsub( "Urchin", "urchin", ad$Taxon )
ad$Taxon <- gsub( "Tubeworms", "Tube worms", ad$Taxon )
ad$Taxon <- gsub( "Urchin", "urchin", ad$Taxon )
# genus "M." is Mastocarpus
ad$Taxon <- gsub( "M[.]", "Mastocarpus ", ad$Taxon )
# Species "M.lat is probably Mastocarpus latissimus
ad$Taxon <- gsub( "Mastocarpus lat.*", "Mastocarpus latissimus", ad$Taxon )
ad$Taxon <- gsub( "Lophopan", "Lophopanopeus bellus", ad$Taxon )
ad$Taxon <- gsub( "Pagurs", "Pagurus", ad$Taxon )
ad$Taxon <- gsub( "Holiclona", "Haliclona", ad$Taxon )
ad$Taxon <- gsub( "Wildmania", "Wildemania", ad$Taxon )
# plural to singular
ad$Taxon <- gsub( "Crabs", "Crab", ad$Taxon )
ad$Taxon <- gsub( "Snails", "Snail", ad$Taxon )
ad$Taxon <- gsub( "Mussels", "Mussel", ad$Taxon )
ad$Taxon <- gsub( "Limpets", "Limpet", ad$Taxon )
ad$Taxon <- gsub( "Kelp Crab", "Kelp crab", ad$Taxon )
ad$Taxon <- gsub( "Isopods", "Isopoda", ad$Taxon )
ad$Taxon <- gsub( "Hydroids", "Hydroid", ad$Taxon )
ad$Taxon <- gsub( "Bryozoans", "Bryozoan", ad$Taxon )
ad$Taxon <- gsub( "Chitons", "Chiton", ad$Taxon )
# other name changes
ad$Taxon <- gsub( "Pugetia firma", "Salishia firma", ad$Taxon )
ad$Taxon <- gsub( "Phycodrys sp.", "Polyneura latissima", ad$Taxon ) #***This seems wrong (PTM)
ad$Taxon <- gsub( "Pterosiphonia dendroidea", "Symphyocladiella dendroidea", ad$Taxon )
# New taxon names in 2019
ad$Taxon <- gsub( "Cryptopleura multiloba", "Hymenena", ad$Taxon )
ad$Taxon <- gsub( "Palmaria mollis", "Devaleraea mollis", ad$Taxon )
ad$Taxon <- gsub( "Dictyosiphon foeniculaceus", "Dictyosiphon sinicola", ad$Taxon )
ad$Taxon <- gsub( "Hedophyllum recruits", "Hedophyllum sessile", ad$Taxon )
ad$Taxon <- gsub( "Polyostea robusta", "Savoiea robusta", ad$Taxon )
# lump Flustralidra with other bryozoans
ad$Taxon <- gsub( "Flustralidra", "Bryozoan", ad$Taxon )
# for numbered species, make a rule about how it should look
ad$Taxon <- gsub( "sp([0-9]+)", "sp.\\1", ad$Taxon )
# trim all the white space
ad$Taxon  <- trimws( ad$Taxon )
# "taxa" to remove
ad <- ad[ !ad$Taxon %in% c( "Animal notes", "Animals" ), ]
ad <- ad[ ad$Taxon != c( "Habitat notes" ), ]
## Use corrected species names to replace taxon names
corrected_taxa <- read.csv( "data/taxa/CorrectedTaxonList.csv" )
# trim all the white space
ad$Taxon  <- trimws( ad$Taxon )
# corrected_taxa2 <- read.csv( "Data/taxa/TaxonList_corrected_lumped_unique.csv" )
# ct <- full_join( corrected_taxa, corrected_taxa2 )
ad.corrected <- left_join( ad, corrected_taxa, by=c("Taxon"="taxon") )
dim(ad)
dim(ad.corrected)
# fix the ones that weren't covered
unique(ad.corrected$Taxon[ is.na(ad.corrected$taxon_corrected) ])
sort(unique(ad$Taxon))
sort(unique(ad.corrected$taxon_corrected))[1:50]
# get rid of category "CORALLINE", which is close to the sum of all coralline species in each quadrat
ad.corrected$Taxon[ad.corrected$taxon_corrected==""]
ad.corrected <- ad.corrected[ ad.corrected$Taxon != "CORALLINE",]
ad.na <- ad.corrected %>% filter( is.na(taxon_corrected) )
sort(unique(ad.na$Taxon))
ad %>% filter( Taxon %in% sort(unique(ad.na$Taxon)) )
# recreat ad with corrected names, then sum across corrected taxa
ad <- ad.corrected %>%
select( UID, Taxon=taxon_corrected, Abundance ) %>%
group_by( UID, Taxon ) %>%
summarise( Abundance=sum(Abundance) )
# Cobble. need to move this to metadata!
ad[ad$Taxon=="Cobble",]
ad[is.na(ad$Taxon),]
ad[ad$Taxon=="BARE ROCK / SUBSTRATE (%)",]
ad[ad$Taxon=="CORALLINE",]
# save the data to disk, overwriting the previous datafile
write_csv( ad, "data/R code for Data Prep/Output from R/Martone_Hakai_data.csv" )
library( tidyverse )
library( tidyverse )
# Data
data <- read_csv( "data/R Code for Data Prep/Output from R/Martone_Hakai_data.csv" )
#metadata
meta<-read_csv( "data/R Code for Data Prep/Output from R/Martone_Hakai_metadata.csv" )
# Unique species from the Data
sort( unique( data$Taxon ) )
# write this list of unique names to file
write_csv( data.frame(taxon=sort(unique( data$Taxon ))),
"data/R Code for Data Prep/Output from R/Martone_Hakai_uniqueTaxa.csv" )
# Load lumping data -- some species are indistinguishable in the field, or were not at the time of the start of the project
lump <- read_csv("data/taxa/TaxonList_corrected_lumped_unique.csv")
# functional group data
functional <- read_csv("Data/taxa/functional_groups.csv")
## merge data with lumped names
lumped.data <- left_join( data, lump, by = c("Taxon"="taxon_corrected") )
## merge functional traits with lumped species
data.funct  <- left_join( lumped.data, functional, by = c("taxon_lumped3"="taxon"))
# # which lines are messed up?
# extras <- data.funct[ duplicated( data.funct[,c(1:7)] ), ]
# sort( unique(extras$Taxon) )
data.funct %>% filter(motile_sessile=="sessile") %>% filter(is.na(funct_2021)) %>%
filter(non.alga.flag == "Algae") %>%
select(taxon_lumped3) %>% distinct()
# write to disk
write_csv( data.funct, "data/R code for Data Prep/Output from R/Martone_Hakai_data_lump_function.csv" )
# Martone Hakai Rocky Shore Seaweed Surveys
#
# by Matt Whalen
# library(profvis)
# profvis({
# This script produces figures of the density of a chosen taxa, saving figures as pdf
taxon <- "Ulva"
# set options
options(stringsAsFactors = FALSE)
# load packages
require(svglite)
library(tidyverse)
library(viridis)
## read data files
# all data
ad <- read.csv( "Data/R Code for Data Prep/Output from R/Martone_Hakai_data_lump_function.csv")
# all metadata
am <- read.csv("Data/R Code for Data Prep/Output from R/Martone_Hakai_metadata.csv" )
# taxa to remove
ad <- ad[ ad$Taxon != "Black spots on Fucus", ]
# customize sites and years
years <- 2012:2022
sites <- c("Fifth Beach", "North Beach","Foggy Cove", "Meay Channel")
metause <- am %>%
filter( Year %in% years ) %>%
filter( Site %in% sites )
# Choose a taxon
sort( unique( ad$taxon_lumped ))
sort( unique( ad$taxon_revised ))
# use general exp to pull several groups if needed
sort(unique( ad$taxon_revised[ grep( paste0(taxon,"*"), ad$taxon_revised ) ]  ))
dtax   <- ad[ grep( paste0(taxon,"*"), ad$taxon_revised ), ]
# merge data and metadata
# get all instances of a particular taxon, and code missing as zero
# include all quadrats
d <- left_join( metause, dtax )
d$Abundance[ is.na( d$Abundance) ] <- 0
# make abundances numeric
sort(unique(d$Abundance))
d$Abundance <- as.numeric( d$Abundance )
# define leveles for zones
d$Zone <- factor( d$Zone, levels = c("LOW","MID","HIGH"), ordered = T )
# define Site order
d$Site <- factor( d$Site, levels = sites )
# define Year factor
d$Year <- factor( d$Year, ordered= TRUE )
#Remove taxa that are NA
d=d[!is.na(d$Taxon),]
# all sites
# time trends in different tidal zones
quartz(5,5)
(ggzone <- ggplot( d, aes(x=as.numeric(as.character(Year)),y=Abundance)) +
facet_grid(Site~Zone, scales="free_y") +
# geom_smooth( se=TRUE, col='black' ) +
stat_summary( fun.data = "mean_cl_boot", colour = "slateblue4", size = 0.5 ) +
stat_summary( fun = "mean", geom="line", colour = "slateblue4", size = 0.5 ) +
geom_point( alpha=0.4,col='slateblue' ) + ggtitle( taxon ) +
xlab("Year") + ylab("Cover (%)") +
scale_x_continuous(breaks = seq(2010,2022,2) ) )
# plot means across the dataset, at least those with SOME presence
# pick transects
d <- d %>%
unite( transect, Site, Zone, remove=F )
dtrans <- d  %>%
group_by( transect ) %>%
summarize( Abundance=sum(Abundance) ) %>%
filter( Abundance>0 )
dall <- d %>%
filter( transect %in% dtrans$transect )
(ggall <- ggplot( dall, aes(x=as.numeric(as.character(Year)),y=Abundance)) +
# facet_grid(Site~Zone, scales="free_y") +
geom_smooth( se=TRUE, col='black' ) +
# stat_summary( fun.data = "mean_cl_boot", colour = "slateblue4", size = 0.5 ) +
# stat_summary( fun = "mean", geom="line", colour = "slateblue4", size = 0.5 ) +
geom_point( alpha=0.4,col='slateblue' ) +
ggtitle( taxon ) +
xlab("Year") + ylab("Cover (%)") +
scale_x_continuous(breaks = seq(2010,2022,2) ) )
ggsave( paste0("R/Figs/",taxon,"_all.svg"), width=3, height=3 )
# Martone Hakai Rocky Shore Seaweed Surveys
#
# by Matt Whalen
# library(profvis)
# profvis({
# This script produces figures of the density of a chosen taxa, saving figures as pdf
taxon <- "Bossiella"
# set options
options(stringsAsFactors = FALSE)
# load packages
require(svglite)
library(tidyverse)
library(viridis)
## read data files
# all data
ad <- read.csv( "Data/R Code for Data Prep/Output from R/Martone_Hakai_data_lump_function.csv")
# all metadata
am <- read.csv("Data/R Code for Data Prep/Output from R/Martone_Hakai_metadata.csv" )
# taxa to remove
ad <- ad[ ad$Taxon != "Black spots on Fucus", ]
# customize sites and years
years <- 2012:2022
sites <- c("Fifth Beach", "North Beach","Foggy Cove", "Meay Channel")
metause <- am %>%
filter( Year %in% years ) %>%
filter( Site %in% sites )
# Choose a taxon
sort( unique( ad$taxon_lumped ))
sort( unique( ad$taxon_revised ))
# use general exp to pull several groups if needed
sort(unique( ad$taxon_revised[ grep( paste0(taxon,"*"), ad$taxon_revised ) ]  ))
dtax   <- ad[ grep( paste0(taxon,"*"), ad$taxon_revised ), ]
# merge data and metadata
# get all instances of a particular taxon, and code missing as zero
# include all quadrats
d <- left_join( metause, dtax )
d$Abundance[ is.na( d$Abundance) ] <- 0
# make abundances numeric
sort(unique(d$Abundance))
d$Abundance <- as.numeric( d$Abundance )
# define leveles for zones
d$Zone <- factor( d$Zone, levels = c("LOW","MID","HIGH"), ordered = T )
# define Site order
d$Site <- factor( d$Site, levels = sites )
# define Year factor
d$Year <- factor( d$Year, ordered= TRUE )
#Remove taxa that are NA
d=d[!is.na(d$Taxon),]
# all sites
# time trends in different tidal zones
quartz(5,5)
(ggzone <- ggplot( d, aes(x=as.numeric(as.character(Year)),y=Abundance)) +
facet_grid(Site~Zone, scales="free_y") +
# geom_smooth( se=TRUE, col='black' ) +
stat_summary( fun.data = "mean_cl_boot", colour = "slateblue4", size = 0.5 ) +
stat_summary( fun = "mean", geom="line", colour = "slateblue4", size = 0.5 ) +
geom_point( alpha=0.4,col='slateblue' ) + ggtitle( taxon ) +
xlab("Year") + ylab("Cover (%)") +
scale_x_continuous(breaks = seq(2010,2022,2) ) )
# Martone Hakai Rocky Shore Seaweed Surveys
#
# by Matt Whalen
# library(profvis)
# profvis({
# This script produces figures of the density of a chosen taxa, saving figures as pdf
taxon <- "Crusticorallina"
# set options
options(stringsAsFactors = FALSE)
# load packages
require(svglite)
library(tidyverse)
library(viridis)
## read data files
# all data
ad <- read.csv( "Data/R Code for Data Prep/Output from R/Martone_Hakai_data_lump_function.csv")
# all metadata
am <- read.csv("Data/R Code for Data Prep/Output from R/Martone_Hakai_metadata.csv" )
# taxa to remove
ad <- ad[ ad$Taxon != "Black spots on Fucus", ]
# customize sites and years
years <- 2012:2022
sites <- c("Fifth Beach", "North Beach","Foggy Cove", "Meay Channel")
metause <- am %>%
filter( Year %in% years ) %>%
filter( Site %in% sites )
# Choose a taxon
sort( unique( ad$taxon_lumped ))
sort( unique( ad$taxon_revised ))
# use general exp to pull several groups if needed
sort(unique( ad$taxon_revised[ grep( paste0(taxon,"*"), ad$taxon_revised ) ]  ))
dtax   <- ad[ grep( paste0(taxon,"*"), ad$taxon_revised ), ]
# merge data and metadata
# get all instances of a particular taxon, and code missing as zero
# include all quadrats
d <- left_join( metause, dtax )
d$Abundance[ is.na( d$Abundance) ] <- 0
# make abundances numeric
sort(unique(d$Abundance))
d$Abundance <- as.numeric( d$Abundance )
# define leveles for zones
d$Zone <- factor( d$Zone, levels = c("LOW","MID","HIGH"), ordered = T )
# define Site order
d$Site <- factor( d$Site, levels = sites )
# define Year factor
d$Year <- factor( d$Year, ordered= TRUE )
#Remove taxa that are NA
d=d[!is.na(d$Taxon),]
# all sites
# time trends in different tidal zones
quartz(5,5)
(ggzone <- ggplot( d, aes(x=as.numeric(as.character(Year)),y=Abundance)) +
facet_grid(Site~Zone, scales="free_y") +
# geom_smooth( se=TRUE, col='black' ) +
stat_summary( fun.data = "mean_cl_boot", colour = "slateblue4", size = 0.5 ) +
stat_summary( fun = "mean", geom="line", colour = "slateblue4", size = 0.5 ) +
geom_point( alpha=0.4,col='slateblue' ) + ggtitle( taxon ) +
xlab("Year") + ylab("Cover (%)") +
scale_x_continuous(breaks = seq(2010,2022,2) ) )
# Martone Hakai Rocky Shore Seaweed Surveys
#
# by Matt Whalen
# library(profvis)
# profvis({
# This script produces figures of the density of a chosen taxa, saving figures as pdf
taxon <- "Alaria"
# set options
options(stringsAsFactors = FALSE)
# load packages
require(svglite)
library(tidyverse)
library(viridis)
## read data files
# all data
ad <- read.csv( "Data/R Code for Data Prep/Output from R/Martone_Hakai_data_lump_function.csv")
# all metadata
am <- read.csv("Data/R Code for Data Prep/Output from R/Martone_Hakai_metadata.csv" )
# taxa to remove
ad <- ad[ ad$Taxon != "Black spots on Fucus", ]
# customize sites and years
years <- 2012:2022
sites <- c("Fifth Beach", "North Beach","Foggy Cove", "Meay Channel")
metause <- am %>%
filter( Year %in% years ) %>%
filter( Site %in% sites )
# Choose a taxon
sort( unique( ad$taxon_lumped ))
sort( unique( ad$taxon_revised ))
# use general exp to pull several groups if needed
sort(unique( ad$taxon_revised[ grep( paste0(taxon,"*"), ad$taxon_revised ) ]  ))
dtax   <- ad[ grep( paste0(taxon,"*"), ad$taxon_revised ), ]
# merge data and metadata
# get all instances of a particular taxon, and code missing as zero
# include all quadrats
d <- left_join( metause, dtax )
d$Abundance[ is.na( d$Abundance) ] <- 0
# make abundances numeric
sort(unique(d$Abundance))
d$Abundance <- as.numeric( d$Abundance )
# define leveles for zones
d$Zone <- factor( d$Zone, levels = c("LOW","MID","HIGH"), ordered = T )
# define Site order
d$Site <- factor( d$Site, levels = sites )
# define Year factor
d$Year <- factor( d$Year, ordered= TRUE )
#Remove taxa that are NA
d=d[!is.na(d$Taxon),]
# all sites
# time trends in different tidal zones
quartz(5,5)
(ggzone <- ggplot( d, aes(x=as.numeric(as.character(Year)),y=Abundance)) +
facet_grid(Site~Zone, scales="free_y") +
# geom_smooth( se=TRUE, col='black' ) +
stat_summary( fun.data = "mean_cl_boot", colour = "slateblue4", size = 0.5 ) +
stat_summary( fun = "mean", geom="line", colour = "slateblue4", size = 0.5 ) +
geom_point( alpha=0.4,col='slateblue' ) + ggtitle( taxon ) +
xlab("Year") + ylab("Cover (%)") +
scale_x_continuous(breaks = seq(2010,2022,2) ) )
## COMBINE
source( "Data/R code for Data Prep/Martone_Hakai_Intertidal_Data_1_CombineAll.R" )
## CLEAN
source( "Data/R code for Data Prep/Martone_Hakai_Intertidal_Data_2_Clean.R" )
## SPECIES LIST
source( "Data/R code for Data Prep/Martone_Hakai_Intertidal_Data_3_SpeciesList.R" )
# Martone Hakai Rocky Shore Seaweed Surveys
#
# by Matt Whalen
# library(profvis)
# profvis({
# This script produces figures of the density of a chosen taxa, saving figures as pdf
taxon <- "Bossiella"
# set options
options(stringsAsFactors = FALSE)
# load packages
require(svglite)
library(tidyverse)
library(viridis)
## read data files
# all data
ad <- read.csv( "Data/R Code for Data Prep/Output from R/Martone_Hakai_data_lump_function.csv")
# all metadata
am <- read.csv("Data/R Code for Data Prep/Output from R/Martone_Hakai_metadata.csv" )
# taxa to remove
ad <- ad[ ad$Taxon != "Black spots on Fucus", ]
# customize sites and years
years <- 2012:2022
sites <- c("Fifth Beach", "North Beach","Foggy Cove", "Meay Channel")
metause <- am %>%
filter( Year %in% years ) %>%
filter( Site %in% sites )
# Choose a taxon
sort( unique( ad$taxon_lumped ))
sort( unique( ad$taxon_revised ))
# use general exp to pull several groups if needed
sort(unique( ad$taxon_revised[ grep( paste0(taxon,"*"), ad$taxon_revised ) ]  ))
dtax   <- ad[ grep( paste0(taxon,"*"), ad$taxon_revised ), ]
# merge data and metadata
# get all instances of a particular taxon, and code missing as zero
# include all quadrats
d <- left_join( metause, dtax )
d$Abundance[ is.na( d$Abundance) ] <- 0
# make abundances numeric
sort(unique(d$Abundance))
d$Abundance <- as.numeric( d$Abundance )
# define leveles for zones
d$Zone <- factor( d$Zone, levels = c("LOW","MID","HIGH"), ordered = T )
# define Site order
d$Site <- factor( d$Site, levels = sites )
# define Year factor
d$Year <- factor( d$Year, ordered= TRUE )
#Remove taxa that are NA
d=d[!is.na(d$Taxon),]
# all sites
# time trends in different tidal zones
quartz(5,5)
(ggzone <- ggplot( d, aes(x=as.numeric(as.character(Year)),y=Abundance)) +
facet_grid(Site~Zone, scales="free_y") +
# geom_smooth( se=TRUE, col='black' ) +
stat_summary( fun.data = "mean_cl_boot", colour = "slateblue4", size = 0.5 ) +
stat_summary( fun = "mean", geom="line", colour = "slateblue4", size = 0.5 ) +
geom_point( alpha=0.4,col='slateblue' ) + ggtitle( taxon ) +
xlab("Year") + ylab("Cover (%)") +
scale_x_continuous(breaks = seq(2010,2022,2) ) )
# Martone Hakai Rocky Shore Seaweed Surveys
#
# by Matt Whalen
# library(profvis)
# profvis({
# This script produces figures of the density of a chosen taxa, saving figures as pdf
taxon <- "Bossiella exarticulata / mayae"
# set options
options(stringsAsFactors = FALSE)
# load packages
require(svglite)
library(tidyverse)
library(viridis)
## read data files
# all data
ad <- read.csv( "Data/R Code for Data Prep/Output from R/Martone_Hakai_data_lump_function.csv")
# all metadata
am <- read.csv("Data/R Code for Data Prep/Output from R/Martone_Hakai_metadata.csv" )
# taxa to remove
ad <- ad[ ad$Taxon != "Black spots on Fucus", ]
# customize sites and years
years <- 2012:2022
sites <- c("Fifth Beach", "North Beach","Foggy Cove", "Meay Channel")
metause <- am %>%
filter( Year %in% years ) %>%
filter( Site %in% sites )
# Choose a taxon
sort( unique( ad$taxon_lumped ))
sort( unique( ad$taxon_revised ))
# use general exp to pull several groups if needed
sort(unique( ad$taxon_revised[ grep( paste0(taxon,"*"), ad$taxon_revised ) ]  ))
dtax   <- ad[ grep( paste0(taxon,"*"), ad$taxon_revised ), ]
# merge data and metadata
# get all instances of a particular taxon, and code missing as zero
# include all quadrats
d <- left_join( metause, dtax )
d$Abundance[ is.na( d$Abundance) ] <- 0
# make abundances numeric
sort(unique(d$Abundance))
d$Abundance <- as.numeric( d$Abundance )
# define leveles for zones
d$Zone <- factor( d$Zone, levels = c("LOW","MID","HIGH"), ordered = T )
# define Site order
d$Site <- factor( d$Site, levels = sites )
# define Year factor
d$Year <- factor( d$Year, ordered= TRUE )
#Remove taxa that are NA
d=d[!is.na(d$Taxon),]
# all sites
# time trends in different tidal zones
quartz(5,5)
(ggzone <- ggplot( d, aes(x=as.numeric(as.character(Year)),y=Abundance)) +
facet_grid(Site~Zone, scales="free_y") +
# geom_smooth( se=TRUE, col='black' ) +
stat_summary( fun.data = "mean_cl_boot", colour = "slateblue4", size = 0.5 ) +
stat_summary( fun = "mean", geom="line", colour = "slateblue4", size = 0.5 ) +
geom_point( alpha=0.4,col='slateblue' ) + ggtitle( taxon ) +
xlab("Year") + ylab("Cover (%)") +
scale_x_continuous(breaks = seq(2010,2022,2) ) )
